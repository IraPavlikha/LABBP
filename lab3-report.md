# Лабораторна робота 3. Real-time функціональність та фіналізація backend
## Платформа для аукціонної торгівлі антикваріатом
## Огляд проєкту

Онлайн-аукціон антикваріату — платформа для купівлі та продажу предметів історичної та культурної цінності. Платформа забезпечує реєстрацію користувачів, створення лотів, участь у торгах у реальному часі, систему ставок та інтеграцію з платіжними сервісами.  

Мета проєкту — забезпечити ефективну, прозору та масштабовану систему онлайн-торгів антикваріатом.

## Мета лабораторної роботи

- Навчитися впроваджувати real-time комунікації через WebSocket (Socket.io).  
- Оптимізувати роботу з базою даних.  
- Провести комплексне тестування серверного застосунку.  
- Розгорнути платформу на production хостингу.

## Технологічний стек

| Компонент | Технологія |
|-----------|------------|
| Frontend | React.js, Redux, Tailwind CSS, CSS-модулі |
| Backend | Node.js, NestJS, Express.js |
| База даних | MongoDB, Mongoose |
| Real-time | Socket.io |
| Зберігання медіафайлів | Cloudinary |
| Документація API | Swagger / Postman |
| Авторизація | JWT токени |

## Архітектура системи

Платформа побудована за принципом клієнт-серверної архітектури:  

- **Клієнтська частина:** React.js, Redux, компонентно-орієнтована структура, адаптивний інтерфейс.  
- **Серверна частина:** Node.js, NestJS, Express.js, REST API, обробка запитів та бізнес-логіки.  
- **База даних:** MongoDB з колекціями `Users`, `Items`, `Bids`, `UserSessions`.  

Діаграми ER та зв’язки між колекціями можна переглянути у проекті (`dbdiagram.io`).

## Функціонал

- Реєстрація та аутентифікація користувачів.  
- Створення та перегляд лотів.  
- Подання ставок у реальному часі.  
- Система сповіщень та оновлень статусів аукціонів.  
- Адміністративна панель для модерації лотів та користувачів.  

### Контролери приклади

**Створення аукціону (`createAuction`)**
```javascript
export const createAuction = async (req, res) => {
    try {
        await connectDB();
        const { itemName, startingPrice, itemDescription, itemCategory, itemStartDate, itemEndDate } = req.body;
        let imageUrl = '';

        if (req.file) {
            try {
                imageUrl = await uploadImage(req.file);
            } catch (error) {
                return res.status(500).json({ message: 'Error uploading image to Cloudinary', error: error.message });
            }
        }

        const start = itemStartDate ? new Date(itemStartDate) : new Date();
        const end = new Date(itemEndDate);
        if (end <= start) {
            return res.status(400).json({ message: 'Auction end date must be after start date' });
        }

        const newAuction = new Product({
            itemName,
            startingPrice,
            currentPrice: startingPrice,
            itemDescription,
            itemCategory,
            itemPhoto: imageUrl,
            itemStartDate: start,
            itemEndDate: end,
            seller: req.user.id,
        });
        await newAuction.save();

        res.status(201).json({ message: 'Auction created successfully', newAuction });
    } catch (error) {
        res.status(500).json({ message: 'Error creating auction', error: error.message });
    }
};

```

Дизайн інтерфейсу
Сторінка перегляду всіх лотів забезпечує доступ до поточних аукціонів у вигляді карток, що містять зображення предмета, назву, короткий опис, поточну ціну та кількість ставок. Для зручності користувача передбачені фільтри за категоріями, ціною та датами проведення аукціону, а також рядок пошуку за назвою або описом лоту. Така організація сторінки дозволяє швидко знаходити необхідні лоти та приймати участь в аукціоні. Кожна картка лоту містить кнопку переходу на детальну сторінку, що дозволяє отримати повну інформацію про конкретний предмет.

<img width="598" height="432" alt="image" src="https://github.com/user-attachments/assets/36d6d425-3e2e-40de-97b1-335c0823702a" />
> **Рисунок 2.6** Сторінка перегляду всіх лотів з фільтрами

Сторінка конкретного лоту відображає детальну інформацію про предмет, включно з описом, фотографіями, датою початку та завершення аукціону, поточною ціною та історією ставок користувачів. Інтерфейс передбачає кнопку для подання нової ставки та відображення максимальної і мінімальної допустимої суми. Крім того, відображається інформація про продавця та залишковий час до завершення аукціону. Така організація даних дозволяє користувачу швидко оцінити стан аукціону та прийняти обґрунтоване рішення щодо участі.

<img width="677" height="476" alt="image" src="https://github.com/user-attachments/assets/4cd45195-d038-4ef1-810f-5f2a7b1aae39" />
> **Рисунок  2.7** Сторінка конкретного лоту
### Real-time функціональність

- Синхронізація ставок у реальному часі через Socket.io.

- Онлайн-статус користувачів.

- Система сповіщень про зміни та нові події.

### Безпека

- Аутентифікація через JWT.

- Middleware для авторизації користувачів.

- Валідація введених даних.

- Шифрування з’єднань та резервне копіювання.

### Оптимізація та масштабування

- Використання індексів у MongoDB.

- Кешування даних та connection pooling.

- Горизонтальне масштабування через Redis adapter (у високому рівні реалізації).

### Документація та тестування

- API задокументоване у Swagger/Postman.

- Тести для основних маршрутів та бізнес-логіки.

##Висновок

Виконання контрольних питань дозволило зрозуміти основи безпеки вебдодатків. Аутентифікація підтверджує особу користувача, а авторизація визначає його права доступу. JWT токени забезпечують безпечну передачу даних, bcrypt із salt захищає паролі. Middleware в Express.js використано для перевірки аутентифікації та ролей (RBAC). Multer керує завантаженням файлів, а пагінація спрощує роботу з великими даними. Swagger автоматично документує API, а застосовані заходи мінімізують загрози безпеки. Access і refresh токени забезпечують зручне та безпечне керування сесіями.

##Відповіді на контрольні питання
### Поясніть різницю між аутентифікацією та авторизацією. Наведіть приклади з вашого проєкту.

Аутентифікація та авторизація – аутентифікація підтверджує особу користувача (логін/пароль), авторизація визначає, що він може робити. У проєкті користувачі входять за паролем (аутентифікація) і мають різні ролі (авторизація).

### Що таке JWT токен і з яких частин він складається? Чому JWT є популярним для аутентифікації в API?

JWT токен – складається з header, payload і signature. Використовується для безпечного обміну інформацією, популярний через відсутність необхідності зберігати сесію на сервері.

### Як працює bcrypt і чому він є безпечним для зберігання паролів? Що таке salt і навіщо він потрібен?

bcrypt – хешує паролі, роблячи їх стійкими до злому. Salt – випадковий рядок, що додається до пароля перед хешуванням для ускладнення атаки методом підбору.

### Поясніть принцип роботи middleware в Express.js. Як ви використали middleware для аутентифікації та авторизації?

Middleware в Express.js – функції, що обробляють запити перед основними маршрутами. У проєкті middleware перевіряє токен та роль користувача перед доступом до ресурсів.


### Що таке RBAC (Role-Based Access Control) і як ви реалізували систему ролей у своєму проєкті?

RBAC – система керування доступом на основі ролей. У проєкті є ролі користувачів (наприклад, admin, user) з різними правами.

### Як працює Multer для завантаження файлів? Які обмеження та валідації ви застосували?

Multer – обробляє завантаження файлів на сервер. Встановлені обмеження на розмір та тип файлів.

### Поясніть, як реалізовано пагінацію в вашому проєкті. Які параметри використовуються?

Пагінація – обмежує кількість даних на сторінку. Використовуються параметри limit (скільки елементів) та page (яка сторінка).

### Що таке Swagger і для чого він використовується? Які переваги автоматичної документації API?\

Swagger – інструмент для документації API. Дає автоматичний опис маршрутів, полегшує тестування і роботу розробників.

### Які основні загрози безпеки існують для вебдодатків? Як ви їх мінімізували в своєму проєкті?

Загрози безпеки – SQL-ін’єкції, XSS, CSRF, витік токенів. У проєкті застосовано перевірку даних, хешування паролів, токени та middleware для захисту.

### Поясніть різницю між access токеном та refresh токеном. Навіщо потрібні два типи токенів?

Access та refresh токени – access короткостроковий для доступу до ресурсів, refresh довгостроковий для оновлення access токена без повторної аутентифікації.
